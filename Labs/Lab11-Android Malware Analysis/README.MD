Objectives
Analyze and reverse engineer a malicious Android app
Overview
In this lab, you will analyze and reverse engineer a malicious Android app. The point of malware analysis is to understand what the malware does. The number of malicious Android apps is staggering. "Every week or so, thereâ€™s a new form of Android malware discovered that works in a unique way from what's come before" [1].

About Android Apps
Java is the official programming language used to write Android apps. An Android app is contained in an APK file (Android Package Kit). An APK file is actually in ZIP format, an archive. Provided an APK file, you can extract the contents of the app and decompile the app.

Unzipping the APK file
Unzipping the APK file via unzip <name_of_app.apk> will extract the following contents:

AndroidManifest.xml - contains app configuration details including app permissions, entry classes, API keys; not human readable
META-INF (directory) - information about the digital signature of the app
classes.dex - a single file, compiled and assembled app code; not human readable
resources.arsc - contains precompiled resources
res (directory) - resources not compiled into resources.arsc including images, strings, and layouts
Tool: apktool
apktool is used to extract the contents of an APK file. The contents can be edited. apktool can also be used to rebuild a modified app. As you can imagine, by modifying contents extracted from an APK file including adding new files, you can build a malicious version of the app. The output of apktool will be a set of files:

A human readable version of the AndroidManifest.xml file
smali (directory)
Of interest is the content in the smali directory. Smali is an assembler for the DEX format used by Dalvik. In other words, Smali is assembly code, more human readable. There is a tool baksmali that takes in a .dex file as input and the output will be .smali files.

Instructions
Download and unzip the following ZIP file containing Android APK onto a Kali Linux VM: https://www.cs.tufts.edu/comp/116/sample-spring2021.zip SHA256(sample-spring2021.zip)= 601c0f9f2be31ab0d6683ca02dbf5d5bdabcd0eaf11a8ed8306fa0571e57a09b **WARNING: DO NOT INSTALL THIS APP ONTO YOUR PRIMARY ANDROID DEVICE AS THIS IS LIVE MALWARE!** Answer the following questions:

Scan the APK file using VirusTotal. What is the detection ratio as returned by VirusTotal?

Using apktool on Kali Linux, extract the contents of the APK file via apktool d <name_of_app.apk>. Take a look at the AndroidManifest.xml file. What permissions do the app have access to? Do any of the permissions look peculiar?

Take a further look at the AndroidManifest.xml file, are there any peculiar activities or Java packages referenced?

Take a look at all the files in the resources folder res. Are there any files look suspicious?

Find and list any suspicious HTTP and/or HTTPS URLs used in .smali files. In which .smail file(s) did you find suspicious HTTP and/or HTTPS URLs? If you find any suspicious URLs, send them to VirusTotal for analysis, and provide the VirusTotal detection ratio for each URL.

What does this app really do, or what do you think this app really do? Provide a brief synopsis. Show all evidence including lines of code in question, and cite any references.

Optional Tools to Use: dex2jar and JD-GUI
One of the outputs of unzipping the contents of an APK file is classes.dex, compiled and assembled app code. A .dex file is a compiled Android application code file. Android programs are compiled into .dex (Dalvik Executable) files. What does that mean? Take a step back: Java programs are compiled to bytecode. Generally speaking, bytecode is computer object code that is processed by a software known as a virtual machine (e.g., the Java VM or JVM). This process is different than what happens when you compile a C/C++ program: a C/C++ program is compiled into machine code which an actual computer can understand and to be directly executed by the CPU. Dalvik is the virtual machine for Android, not JVM. Thus, .dex files contain bytecode. Both bytecode and machine code are not human readable and are difficult to edit. If you are familiar with Java, a .class file is analagous to a .dex file --with some notable differences [2].

You may be curious if it is possible to decompile the process: that is, reverse the compilation process from the .dex file to the high-level and readable .java file. Yes it is possible but it may not be perfect. You will need to use two tools: dex2jar to decompile the .dex file into a .jar file (a set of .class files), and then use JD-GUI to display Java source codes of .class files (that is, .java files).

dex2jar - https://github.com/pxb1988/dex2jarLinks to an external site.
https://stackoverflow.com/questions/5257830/how-to-use-dextojarLinks to an external site.
JD-GUI - https://java-decompiler.github.io/Links to an external site.
References
"How to Analyze an Android Bot" by Kevin McNamee (RSA Conference 2016) https://comp116.org/readings/mbs-r02-how-to-analyze-an-android-bot.pdfLinks to an external site.
If you are familiar with Java, you may be curious what's the difference between .class and .dex files: https://stackoverflow.com/questions/8210173/what-is-the-difference-between-class-and-dex-filesLinks to an external site.
